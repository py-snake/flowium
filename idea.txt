Képfeldolgozás féléves feladat ötlet

Bevezető
BSc tnaulmányaim során mások projektjeit, szakdolgozatát figyelve felkeltette az érdeklődésem az objektum detektálás képeken, valósidejű videón. Ugyan érdeklődésem megvolt a téma iránt, de soha nem volt szükségem ilyen jellegű projektre a hétköznapokban. A féléves feladat kapcsán ötleteltem, átgondoltam hogy lehetne összekötni ezt az évek óta meglévő kíváncsiságot és a tantárgy követelményeit. Egy barátom által fejlesztett rendszerben megláttam a valósidőben tanuló neurális hálózatok szépségét, és a Tanár úr által mondott órai példa, jármű detektálás alapján jött a következő ötlet: járműdetektálás valós időben élő kamera képről és valósidőben tanuló neurális hálózat tanítása forgalmi adatok becslésére, időpont és akár időjárási körülmények figyelembevételével.
A tervem egy forgalom becslő alkalmazás elkészítése, amely egy közúti kamera képe alapján tanul. Sok online, élőben elérhető közterületet vagy közutat figyelő kamerát átnéztem, de legnagyobb bánatomra ezek annyira voltak élők, hogy percenként 1 képet rögzítettek. Jobb esetben 10-15 másodpercenként érkezett egy kép. Ezek a célra egyáltalán nem felelnek meg, ennyi idő alatt számtalan jármű elhaladhat alattuk. Végül az összes magyar kamerás oldal átnézése után eszembe jutott a YouTube élők átnézése mint opció, és találtam is egy 2023 óta folyamatosan közvetítő Bajai kamera képet, amely egy parkra és közútra néz, 1920x1080 pixel felbontással és 30fps képkockasebességgel rendelkezik. Ez a forrás véleményem szerint megfelelő a feladatra. Amennyiben nem sikerül használható minőséget kapni róla, külföldi kamerára vagy rögzített videó fájlra való átállás lesz szükséges.
A következő fejezetekben a technikai megvalósítás lehetséges megközelítéseit vázolom, ami persze előretekintve jó ötletnek tűnik, de a megvalósítás során változhat.

Élő kamerakép
A bevezetőben ismertetett, YouTube-on elérhető Bajai Sugovica-sétányra néző kamera a tervezett videó forrás. Technikai adatai közé tartozik az 1920x1080 pixel képfelbontás és 30fps képkockasebesség. Az adás élő, 7/24 közvetített. A látott kép 3 fő szekcióra osztható: égbolt (időjárási viszonyok, napszak, természeti jellemzők), gyalogos sétány (szerencsés esetben követhető lenne a gyalogos forgalom, de jelenlegi feltételezésem alapján túl apró a kép hozzá), közút (sajnos az út egy részét fák takarják, de egy szakaszon tökéletes rálátás van a közlekedő járművekre). A kamera nappali fényviszonyok mellett kiváló képet közvetít, az éjszaka során az erős kivilágításnak köszönhetően sincs túlságosan sok zaj a képen.
Az élő streamet yt-dlp, ffmpeg és opencv segítségével tudnám betölteni és hasznosítani.

Kamerakép előfeldolgozása
Mint korábban említettem, a kamera nagy területet fog be, ezeket különbözően lehetne hasznosítani. Elsősorban a járművek detektálására szeretnék koncentrálni, ehhez egy körülbelül 800x400 pixel területre kéne koncentrálni.
A hardveres erőforrásaim erősen korlátazottak, GPU egyáltalán nem áll rendelkezésemre, tehát a lehető leghatékonyabban kell elkészíteni a programot. A feldolgozásra vagy laptop processzor (Intel(R) Core(TM) i5-8350U CPU @ 1.70GHz, 4C/8T) vagy bérelt vps dedikált 4 magja (AMD EPYC 9634 84-Core Processor @ 2.20GHz, 4C/4T) áll rendelkezésemre.
A beérkező 1920x1080 képből első lépésként a közutat rögzítő, körülbelül 800x400 pixeles kép kivágását kell megtenni, majd esetlegesen napszaktól, időjárási viszonyoktól függően opencv segítségével hisztogram kiegyenlítést, kontrasztfokozást, zajszűrést végezni. A bejövő 30fps helyett valószínűleg 4-8fps közötti feldolgozási sebesség lesz reális a rendelkezésre álló hardveren, tehát minden 4-7. frame fog feldolgozásra kerülni, a többi eldobásra.

Járműdetektálás az előfeldolgozott képeken
A kamerakép oldalnézetből mutatja a közutat, de még így is látható az elhaladó járművek alakja, mozgása. A detektálásukhoz YOLOv5 vagy YOLOv8 alapú megközelítést tartok reálisnak. Ezzel a módszerrel a tervek szerint felismerhető és követhető lesz a járművek mozgása valósidőben. A detektálás körülményeit, mint dátum, időpont, (időjárási körülmények) egy csv állományban vagy esetleg adatbázisban tárolnám, valamint átadnám a valósidőben tanuló neurális hálónak. A rögzített adatok később jó dataset-ként szolgálhatnának, mivel valós környezetben, több paraméter feljegyzésével lennének tárolva. Ebből később más neurális hálókat is lehetne tanítani, esetleg teljesítményt összehasonlítani. Forgalmat becsülni a jövőre nézve.
A mozgást ugyan lehetne opencv alapokon detektálni, de tartok tőle hogy az oldalnézet, távoli kamerakép miatt nem birkózna meg a feladattal az elvárt pontossággal neurális háló bevetése nélkül.

Adatrögzítés, mentés
A detektált objektumokról készülő feljegyzéseket egyszerű csv szöveges állományban is lehetne tárolni, de ha hosszútávú üzemeltetés a cél, jobb lenne valamilyen adatbázist használni, például egyszerű helyi SQLite alapú tárolást. Ez a megközelítés jelentősen gyorsítaná nagy mennyiségű adat tárolását, és nem járna nagy többlet erőforrás igénnyel. A feldolgozás jelentősen gyorsul, lekérdzések, keresések, statisztikák, exportálás, biztonsági mentés könnyedén végezhető.
A tárolni kívánt adatmezőket a későbbiekben szeretném pontosan meghatározni attól függően, hogy milyen adatok lesznek elérhetők (például az időbélyegen kívül esetleg autó típus méret alapján, ideiglenes egyedi azonosító a járműre , konfidencia). Amennyiben időjárásadatok és esetleg más, a forgalmat befolyásoló tényezők tárolása bevezetésre kerülne, további adatmezőket kell felvenni.

Valós idejű tanulás
A terv egy online tanuló rendszer elkészítése, amely a beérkező adatokat feldolgozva folyamatosan képes a tanulásra. A megvalósításhoz a River python csomag illeszkedne, mivel online tanuló algoritmusok vannak benne implementálva. A módszer előnye, hogy nem lenne időszakosan kimagasló erőforrásigénye, hanem egy folyamatos egyenletes terhelést jelentene a rendszer számára. Ezzel a megközelítéssel nem lenne szükség a régi adatok újra tanulására, hanem a modell folyamatosan frissítésre kerülne.

Kiegészítő adatok, például időjárás és környzeti tényezők
A forgalmat és a járműdetektálás sikerességét egyaránt befolyásolhatják az időjárási tényezők, ezért véleményem szerint érdemes lenne feljegyezni ezeket az adatokat is. Az időjárási viszonyok hatást gyakorolhatnak a forgalom sűrűségére, így ezek rögzítésével lehetne elemezni az összefüggéseket, és esetleg pontosabb becslést adni a felépített modellel. A rossz látási viszonyok a járműdetektálást is negatívan befolyásolhatják, mivel esős viharos időben jelentősen romlik a kamera által rögzített kép. Ekkor elképzelhető lehet, hogy ugyan a valóságban megnő a forgalom, de a rossz képminőség miatt csak a járművek töredéke lesz feljegyezve.
Az időjárásadatok forrása lehetne maga a kamerakép, valamilyen módon felismerni a környezeti tényezőket valós időben. Ez nagy erőforrásigénnyel járna és korlátozottan lehetne eljárni. Ezzel ellentétes megközelítés egy időjárás API használata, vagy időjárás weboldalról legyűjtött adatok használata. Ennek előnye, hogy jóval kevesebb erőforrásra van szükség hozzá, több környezeti jellemzőhöz tényszerűen hozzá lehet férni (hőmérséklet, páratartalom, eső vagy napsütés, napfelkelte, napnyugta, szélerősség), viszont hátránya, hogy bizonyos esetekben pontatlan lehet. Pontatlanságot okozhat, ha az online előrejelzés szerint az adott időszakban esőzés van a területen, ám a kamera képe szerint csak felhős az idő, de a valóságban nem esik eső. Ennek kiküszöbölésére hibrid megközelítést lehetne alkalmazni, de ez jelenleg túlmutat a projekt keretein.
A rögzített időjárási adatokkal elemehetővé válik a forgalmi minta és az időjárás összefüggése, vagy a detektálási hiba alakulása nem várt időjárási körülmények közt.

Futtatási környezet, rendszerek összekapcsolása
A projekt megvalósítása Python programozási nyelven tervezett, különböző Python könyvtárak felhasználásával. Az egységbe csomagolás, könnyű telepítés és hordozhatóság érdekében a teljes rendszert szerepkörök alapján felbontva, docker alapú konténerekbe szervezve, API alapú kommunikációval tervezem megvalósítani. A tervezett szerepkörök körülbelül megfelelnek a felsorolt pontoknak: élő kamerakép fogadása (yt-dlp), kép előfeldolgozása (ffmpeg, opencv), járműdetektálás (YOLO), adatrögzítés (SQL vagy SQLite), online tanulás (River), kiegészítő szolgáltatások, például időjárás API.

Használni tervezett rendszerek

Kategória	Technológia	Felhasználás
Programozási nyelv	Python	Fejlesztési környezet
Videó stream	yt-dlp	YouTube stream letöltése
Videó feldolgozás	Ffmpeg	Videó feldolgozása
Gépi látás	OpenCV	Videó és kép feldolgozása
Objektum detektálás	YOLOv5 vagy YOLOv8	Járműdetektálás és követés
Adatbázis	SQLite	Adattárolás
Online tanulás	River	Valós idejű modell létrehozása
Adatmanipuláció	Pandas	Adatfeldolgozás
Adatmanipuláció	NumPy	Adatfeldolgozás
Webkliens	Requests	API kommunikáció
Webkliens	curl	Web és API kommunikáció
Vizualizáció	Matplotlib	Grafikonok
Vizualizáció	Seaborn	Statisztikai ábrák
API keretrendszer	FastAPI	REST API végpontok
Machine learning	Scikit-learn	Modellek
Konténerizáció	Docker	Környezetek futtatása
Verziókezelés	Git	Fejlesztés követése

Mintaképek
Nappali és éjszakai mintakép. Jól látható, hogy szép időjárás és megfelelő fényviszonyok közt elég jó a képminőség, a feladatnak megfelelő lesz a forrás. Mintakép a járműdetektálás szempontjából releváns területről. Az eltérő időpontok kissé eltérő színvilágú képeket eredményeznek.

